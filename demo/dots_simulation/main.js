var v=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(h,l){if(h==="2dGrid"){let i=v.call(this,"2d",l),s=()=>{let t=Math.min(this.width,this.height)/(l.minAxisLength*2);if(i.pixelMeterRatio=t,this.width>=this.height)i.X_MINMAX=[-(this.width/2)/t,this.width/2/t],i.Y_MINMAX=[-100,100];else i.X_MINMAX=[-100,100],i.Y_MINMAX=[-(this.height/2)/t,this.height/2/t]};i.metersToPixels=function(...t){return t.map((n)=>{return n*this.pixelMeterRatio})},i.transformCoordinates=function(t,n,o){let e=t.canvas.width/2,a=t.canvas.height/2;return[n,o]=this.metersToPixels(n,o),[e+n,a-o]},i.drawGrid=function(){this.beginPath();for(let t=this.Y_MINMAX[0];t<this.Y_MINMAX[1];t+=10)this.moveTo(this.X_MINMAX[0],t),this.lineTo(this.X_MINMAX[1],t);for(let t=0;t>this.X_MINMAX[0];t-=10)this.moveTo(t,this.Y_MINMAX[0]),this.lineTo(t,this.Y_MINMAX[1]);for(let t=0;t<this.X_MINMAX[1];t+=10)this.moveTo(t,this.Y_MINMAX[0]),this.lineTo(t,this.Y_MINMAX[1]);this.strokeStyle="rgb(61, 61, 61, 0.3)",this.stroke(),this.beginPath(),this.moveTo(this.X_MINMAX[0],0),this.lineTo(this.X_MINMAX[1],0),this.moveTo(0,this.Y_MINMAX[0]),this.lineTo(0,this.Y_MINMAX[1]),this.strokeStyle=l.color,this.stroke(),this.drawLabels()},i.drawLabels=function(){this.fillStyle="black",this.textAlign="center",this.textBaseline="middle";for(let t=10;t<this.Y_MINMAX[1];t+=10)this.fillText(t.toString(),2,t-1.4);for(let t=-10;t>this.Y_MINMAX[0];t-=10)this.fillText(t.toString(),2,t-1.4);for(let t=0;t<this.X_MINMAX[1];t+=10)this.fillText(t.toString(),t+2,-1.4);for(let t=-10;t>this.X_MINMAX[0];t-=10)this.fillText(t.toString(),t+2,-1.4)};let T=i.rect;i.rect=function(t,n,o,e){let[a,c]=this.transformCoordinates(this,t,n);return[o,e]=this.metersToPixels(o,e),T.call(this,a-o/2,c-e/2,o,e)};let g=i.moveTo;i.moveTo=function(t,n){let[o,e]=this.transformCoordinates(this,t,n);return g.call(this,o,e)};let p=i.lineTo;i.lineTo=function(t,n){let[o,e]=this.transformCoordinates(this,t,n);return p.call(this,o,e)};let x=i.arc;i.arc=function(t,n,o,e,a,c){let[_,I]=this.transformCoordinates(this,t,n);return x.call(this,_,I,o,e,a,c)};let N=i.fillText;i.fillText=function(t,n,o,e){let[a,c]=this.transformCoordinates(this,n,o);return e=e?this.metersToPixels(e)[0]:e,N.call(this,t,a,c,e)};let w=i.fillRect;i.fillRect=function(t,n,o,e){let[a,c]=this.transformCoordinates(this,t,n);return[o,e]=this.metersToPixels(o,e),w.call(this,a-o/2,c-e/2,o,e)},s();let u=new ResizeObserver(()=>{s()});u.observe(this);let X=new MutationObserver((t)=>{for(let n of t)if(Array.from(n.removedNodes).includes(this))u.unobserve(this),X.disconnect()});return X.observe(document.body,{childList:!0,subtree:!0}),i}else return v.call(this,h,l)};var m=document.createElement("button");m.innerText="Add 10 to canvas width";var r=document.createElement("canvas");r.style.border="1px solid black";m.onclick=()=>{console.log("clicked"),r.width=r.width+100,console.log("canvas.width",r.width)};r.width=window.outerWidth*0.9;r.height=window.outerHeight*0.9;document.body.appendChild(m);document.body.appendChild(r);var d=r.getContext("2dGrid",{minAxisLength:100,color:"pink"});d.drawGrid();var f,M=[];for(let h=0;h<10;h++){let l={position:[0,0],velocity:[Math.floor(Math.random()*30)-15,Math.floor(Math.random()*40)],acceleration:[0,-9.81],color:`rgb(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255})`};M.push(l)}function A(h){if(f===void 0)f=h;let l=(h-f)*2;f=h,d.clearRect(0,0,r.width,r.height),d.drawGrid();for(let i=0;i<M.length;i++){let s=M[i];if(s.velocity[0]+=s.acceleration[0]*(l*0.001),s.position[0]+=s.velocity[0]*(l*0.001),s.velocity[1]+=s.acceleration[1]*(l*0.001),s.position[1]+=s.velocity[1]*(l*0.001),s.position[1]<=-40)s.velocity[1]*=-1,s.position[1]=-40;if(s.position[0]<=-40||s.position[0]>=40)s.velocity[0]*=-1;d.fillStyle=s.color,d.fillRect(s.position[0],s.position[1],2,2)}requestAnimationFrame(A)}requestAnimationFrame(A);
